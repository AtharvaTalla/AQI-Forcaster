# AQI Prediction using Machine Learning

A complete machine learning project to forecast the next-day Air Quality Index (AQI) for major Indian cities. This project uses historical pollution data to train a time-series regression model, then serves the predictor via an interactive Streamlit app.

Note: Create an `assets/` folder and add the `prediction_vs_actual.jpg` plot (generated by the training script) into it so the app and README visual references work.

---

## Table of Contents

- [Project Overview](#project-overview)
- [Features](#features)
- [Repository Structure](#repository-structure)
- [Requirements](#requirements)
- [Setup & Run](#setup--run)
  - [1. Environment setup](#1-environment-setup)
  - [2. Install dependencies](#2-install-dependencies)
  - [3. Run training pipeline](#3-run-training-pipeline)
  - [4. Run Streamlit app](#4-run-streamlit-app)
- [Training Pipeline (aqi_prediction_notebook.py)](#training-pipeline-aqi_prediction_notebookpy)
- [Inference / Streamlit App (streamlit_app.py)](#inference--streamlit-apppystreamlit_apppy)
- [Model Details & Evaluation](#model-details--evaluation)
- [Visualizations](#visualizations)
- [Future Improvements](#future-improvements)
- [Troubleshooting](#troubleshooting)
- [License & Contact](#license--contact)

---

## Project Overview

This project trains a time-series regression model to predict the next day's AQI for Indian cities using historical pollutant and AQI data (the `city_day.csv` file from the "Air Quality in India" dataset). It includes complete preprocessing, feature engineering, model training with hyperparameter tuning, model persistence, and a Streamlit UI for inference.

---

## Features

- Data cleaning including time-based interpolation for missing pollutant measurements
- Feature engineering:
  - Lag features (e.g., AQI_lag_1, AQI_lag_2, AQI_lag_3)
  - Rolling averages (7-day and 30-day)
  - Pollutant lags (PM2.5_lag_1, CO_lag_1, etc.)
  - Date features (month, day_of_week, day_of_year)
- Baseline model: Linear Regression
- Final model: RandomForestRegressor with RandomizedSearchCV hyperparameter tuning
- TimeSeriesSplit cross-validation
- StandardScaler for feature scaling
- Model persistence with joblib (`aqi_rf_model.joblib` and `aqi_scaler.joblib`)
- Streamlit app for interactive predictions

---

## Repository Structure

- aqi_prediction_notebook.py        - Training pipeline (scriptable notebook)
- streamlit_app.py                  - Streamlit web application for inference
- requirements.txt                  - Required Python packages
- assets/                           - Folder for images/plots used by the app (create this)
  - prediction_vs_actual.jpg        - Place training plot here
- aqi_rf_model.joblib               - Trained Random Forest model (generated by training)
- aqi_scaler.joblib                 - Scaler object used at training time (generated by training)
- README.md                         - This file

---

## Requirements

- Python 3.8 - 3.11
- Packages in `requirements.txt` (typical packages used):
  - pandas
  - numpy
  - scikit-learn
  - joblib
  - matplotlib
  - seaborn
  - streamlit

---

## Setup & Run

### 1. Environment setup

Clone the repo and create a virtual environment:

# Clone the repository (if using Git)
# git clone https://github.com/YOUR_USERNAME/YOUR_REPO_NAME.git
# cd YOUR_REPO_NAME

# Create a virtual environment
python -m venv venv

# Activate the virtual environment
# On Windows (CMD)
.\venv\Scripts\activate
# On Windows (PowerShell)
.\venv\Scripts\Activate.ps1
# On macOS/Linux
source venv/bin/activate

### 2. Install dependencies

pip install -r requirements.txt

If you don't have a requirements file, install the core packages manually:
pip install pandas numpy scikit-learn joblib matplotlib seaborn streamlit

### 3. Run training pipeline

Before using the Streamlit app you must train the model and produce the saved model + scaler files:

python aqi_prediction_notebook.py

What this script does:
- Loads `city_day.csv` (Air Quality in India dataset)
- Filters and preprocesses data for a target city (default: Delhi)
- Handles missing values with time-based interpolation
- Builds lag + rolling + date features
- Splits data with TimeSeriesSplit
- Scales features using StandardScaler
- Trains baseline LinearRegression and a RandomForestRegressor
- Tunes RandomForest via RandomizedSearchCV
- Evaluates performance (R², MAE, RMSE)
- Saves `aqi_rf_model.joblib` and `aqi_scaler.joblib`
- Creates plots (feature importance, prediction_vs_actual, etc.) and saves `assets/prediction_vs_actual.jpg`

Important: Ensure `assets/` exists before running the training script or create it after and place the generated images there.

### 4. Run Streamlit app

After training, run the Streamlit app:

streamlit run streamlit_app.py

Streamlit will open a browser window where you can:
- Upload your `city_day.csv` (or other compatible CSV)
- Select a city
- Let the app run same preprocessing and feature engineering
- Get the next-day AQI prediction based on the latest data row

---

## Training Pipeline (aqi_prediction_notebook.py)

Key steps implemented in the training script:
1. Load `city_day.csv`
2. Filter to one city (example: Delhi) for training
3. Convert date column to datetime and set index
4. Interpolate missing pollutant columns using time-based / linear interpolation
5. Create features:
   - AQI_lag_1, AQI_lag_2, AQI_lag_3
   - AQI_rolling_7d_mean, AQI_rolling_30d_mean
   - Pollutant_lag_1 (PM2.5, PM10, CO, NO2, O3, etc.)
   - month, day_of_week, day_of_year
6. Train baseline LinearRegression and evaluate
7. Use TimeSeriesSplit and RandomizedSearchCV to tune RandomForestRegressor
8. Fit final model on full training data and save model + scaler

---

## Inference / Streamlit App (streamlit_app.py)

- Loads `aqi_rf_model.joblib` and `aqi_scaler.joblib`
- Accepts a CSV upload from the user
- Lets the user choose a city present in the CSV
- Performs identical preprocessing and feature engineering
- Uses the saved scaler to transform the most recent feature row(s)
- Predicts the next-day AQI and displays the value and simple visualizations

Tip: The app assumes the uploaded CSV has the same schema as the Air Quality in India `city_day.csv`. If you use a custom dataset, ensure column names align.

---

## Model Details & Evaluation

Example results reported for Delhi (from the notebook):

- Baseline (Linear Regression)
  - R²: 0.902
  - MAE: 5.88
  - RMSE: 5.91

- Final (Tuned Random Forest)
  - R²: 0.892
  - MAE: 27.84
  - RMSE: 37.72

Interpretation:
- The RMSE/MAE indicate the average error in AQI predictions. Depending on the dataset split and feature set these may vary. Feature engineering (lags + rolling averages) is a key reason for good performance.

---

## Visualizations

The training script generates plots and saves them to `assets/`:
- Feature Importance (shows top predictors, e.g., AQI_lag_1, AQI_rolling_30d_mean)
- Prediction vs Actual plot (`assets/prediction_vs_actual.jpg`) — please ensure this file exists for the app and README
- AQI trend over time
- Feature correlation heatmap

---

## Future Improvements

- Integrate weather data (temperature, humidity, wind speed) as external features
- Try sequence models like LSTM or Transformer for time series forecasting
- Test Prophet or other advanced forecasting libraries
- Deploy the Streamlit app to Streamlit Community Cloud, Heroku, or Hugging Face Spaces
- Add uncertainty estimates (prediction intervals)

---

## Troubleshooting

- "Model files not found": Make sure you ran `aqi_prediction_notebook.py` and that `aqi_rf_model.joblib` and `aqi_scaler.joblib` exist in the project root.
- "Missing columns in uploaded CSV": Ensure the uploaded CSV follows the schema from the Air Quality in India dataset (columns like `city`, `date`, `AQI`, `PM2.5`, `PM10`, `CO`, etc.).
- If training is slow, reduce the number of RandomizedSearchCV iterations or sample the dataset.

---

## License & Contact

This project is provided as-is for educational purposes. Feel free to use and adapt the code for research or learning.

Author: AtharvaTalla

If you need help adapting the notebook, preparing the dataset, or deploying the Streamlit app, open an issue or reach out.

```
